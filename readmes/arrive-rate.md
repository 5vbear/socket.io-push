# 离线通知送达率

计算socket.io通道,android的送达率方法

## 1.指定单个/多个设备的送达率 

分子: 收到通知, 客户端回包, +1 

分母: 调用推送api的时候,所传的设备id数/所传uid对应的设备id数

此项指标与业务相关度非常大, 因为很多设备会卸载app, 这些设备必然会收不到推送, 而服务器无法清除这些已经卸载的无效设备.
随着app寿命增加, 无效设备会越来越多, 送达率会越来越低, 当然这个可以通过对设备id设一个过期时间来解决, 不过目前我们并没有做.
此项送达率也跟推送目标有关,比如对一个主播的所有粉丝发推送, 送达率, 跟其僵尸粉数量也有关系.

## 2.全网离线推送送达率

分子: 收到通知, 客户端回包, +1 

分母: 例如设置离线有效期为1小时, 分母应该为从调用全网api开始, 到一个小时后, 所有连接到推送服务器的客户端.
如何计算: 记录最近7天(推送服务器支持的最大离线有效期), 连接到推送服务器的所有客户端的设备id,最后连接时间,最后断线时间. 在某条推送到了有效期后, 遍历所有设备连接信息,算出分母.

此项指标可以比较客观衡量推送系统的服务质量.但计算成本较高.
